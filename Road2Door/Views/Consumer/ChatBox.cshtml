<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="chat-container">
                <div class="chat-header">
                    <h4>Chat Room</h4>
                </div>
                <div class="chat-messages" id="messagesList"></div>
                <div class="chat-input">
                    <form>
                        <div class="form-group">
                            <span id="userInput">@ViewBag.Name</span>
                        </div>
                        <div class="form-group">
                            <input type="text" id="messageInput" class="form-control" placeholder="Type your message..." required>
                        </div>
                        <button type="submit" id="sendButton" class="btn btn-primary">Send</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/microsoft/signalr/dist/browser/signalr.min.js"></script>

<script src="/chathub"></script>
<script>
    var connection = new signalR.HubConnectionBuilder().withUrl("/chathub").build();

    connection.on("ReceiveMessage", function (user, message) {
        console.log(user);
        var messageHtml = `<div class="chat-message ${user === $("#userInput").text() ? "sent" : "received"}">
                                              <span class="message-sender">${user}</span>
                                              <span class="message-time">${new Date().toLocaleTimeString()}</span>
                                              <p>${message}</p>
                                           </div>`;

        $("#messagesList").append(messageHtml);
    });

    connection.start().catch(function (err) {
        return console.error(err.toString());
    });


    $("#sendButton").click(function () {
        var user = $("#userInput").text();
        var message = $("#messageInput").val();
        connection.invoke("SendMessage", user, message).catch(function (err) {
            return console.error(err.toString());
        });
        $("#messageInput").val("").focus();
    });

    $("#messageInput").keypress(function (event) {
        if (event.keyCode === 13) {
            $("#sendButton").click();
        }
    });
</script>